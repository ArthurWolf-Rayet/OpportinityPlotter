<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Padua Redemption: Opportunity Map</title>
<style>
:root{
  /* Sci-fi palette */
  --bg0:#05070c; --bg1:#070b12;
  --panel: rgba(10, 16, 26, 0.72);
  --border: rgba(110, 240, 255, 0.22);
  --text: rgba(235, 250, 255, 0.92);
  --muted: rgba(235, 250, 255, 0.62);
  --cyan: rgba(110, 240, 255, 0.95);
  --purple: rgba(180, 120, 255, 0.95);
  --good: rgba(120, 255, 200, 0.95);
  --bad: rgba(255, 120, 140, 0.95);
}

*{box-sizing:border-box}
html, body { height: 100%; overflow: hidden; /* Prevent scrolling */ }
body{
  margin:0; 
  display:flex; flex-direction: column; align-items:center; justify-content: center;
  color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
  background:
    radial-gradient(1200px 700px at 20% 15%, rgba(110,240,255,0.12), transparent 55%),
    radial-gradient(1000px 650px at 80% 30%, rgba(180,120,255,0.10), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
}

.wrap{
    width: 95vw;
    height: 95vh;
    display: flex; flex-direction: column;
    text-align:center;
}

h1{
  margin: 0 0 4px;
  font-size: clamp(24px, 3vw, 42px);
  letter-spacing: .12em;
  text-transform: uppercase;
  font-weight: 800;
  text-shadow: 0 0 18px rgba(110,240,255,0.18);
}
.subtitle {
    margin-bottom: 12px; color: var(--muted); letter-spacing: 0.08em; text-transform: uppercase; font-size: 12px;
}

.card{
  flex: 1; /* Fill remaining space */
  display: flex; flex-direction: column;
  background: linear-gradient(180deg, rgba(10,16,26,0.78), rgba(7,10,16,0.72));
  border: 1px solid rgba(110,240,255,0.18);
  border-radius: 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.55), 0 0 0 1px rgba(180,120,255,0.10) inset;
  padding: 18px;
  position:relative;
  overflow: hidden; 
}

/* TOPBAR */
.topbar{
  display:flex; gap:12px; flex-wrap:wrap;
  align-items:stretch; justify-content:space-between;
  margin-bottom:10px;
  flex-shrink: 0; /* Don't shrink the header */
}
.pill{
  flex:1 1 200px;
  background: linear-gradient(180deg, rgba(10,16,26,0.70), rgba(8,12,20,0.62));
  border: 1px solid rgba(110,240,255,0.16);
  border-radius: 16px;
  padding: 10px 14px;
  min-height: 70px;
  display:flex; flex-direction: column; justify-content: center;
  box-shadow: 0 0 0 1px rgba(180,120,255,0.08) inset;
}
.pill-title { font-weight: 700; color: var(--text); font-size: 13px; margin-bottom: 6px; text-transform: uppercase;}

/* UPLOAD BUTTON styling */
input[type="file"] { display: none; }
.btn-upload {
    display: inline-block;
    border: 1px dashed rgba(110,240,255,0.4);
    background: rgba(110,240,255,0.05);
    color: var(--cyan);
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 11px; text-align: center;
    transition: all 0.2s;
}
.btn-upload:hover { background: rgba(110,240,255,0.15); border-color: var(--cyan); }

/* PROGRESS BAR */
.progress-container {
    background: rgba(0,0,0,0.4);
    border-radius: 99px; height: 10px; width: 100%;
    border: 1px solid rgba(110,240,255,0.2);
    overflow: hidden; margin-top: 5px;
}
.progress-fill {
    height: 100%; width: 0%;
    background: linear-gradient(90deg, var(--cyan), var(--purple));
    transition: width 0.4s ease;
    box-shadow: 0 0 10px rgba(110,240,255,0.3);
}

/* MAIN VIEW AREA (Responsive) */
.viewport-wrapper {
    flex: 1; /* Take up available space */
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    padding: 10px;
}

.map-viewport {
    /* Responsive Sizing Logic */
    width: 85vw; 
    max-height: 55vh; /* Ensure it doesn't push controls off screen */
    aspect-ratio: 16 / 9; /* Keep 1920x1080 ratio */
    
    border: 2px solid rgba(110,240,255,0.3);
    background: #000;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    transition: all 1.5s cubic-bezier(0.19, 1, 0.22, 1);
}

/* Collapse Animation Class */
.map-viewport.collapsed {
    transform: scale(0.01) rotate(90deg);
    opacity: 0;
    border-color: var(--good);
    box-shadow: 0 0 100px var(--good);
}

/* Uploaded Image Layer */
.map-image {
    width: 100%; height: 100%;
    object-fit: cover;
    opacity: 0.8;
    position: absolute; top:0; left:0; z-index: 0;
}

/* Grid Overlay - Scaled to % */
.grid-overlay {
    position: absolute; inset: 0; pointer-events: none; z-index: 10;
    /* 4% width matches object size */
    background-size: 4% 100%; 
    /* Create a grid pattern using gradients */
    background-image: 
        linear-gradient(to right, rgba(110,240,255,0.1) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(110,240,255,0.1) 1px, transparent 1px);
    background-size: 4% calc(4% * 1.777); /* Adjust height for aspect ratio */
}

/* Map Objects - Responsive */
.map-obj {
    position: absolute;
    width: 4%;  /* Relative to container width */
    height: auto;
    aspect-ratio: 1/1; /* Square objects */
    cursor: grab;
    z-index: 20;
    user-select: none;
    transition: filter 0.2s;
}
.map-obj:active { cursor: grabbing; }
.map-obj.selected {
    filter: drop-shadow(0 0 6px #fff);
    outline: 2px solid #fff;
}

/* CONTROLS (Bottom) */
.controls-bar {
    display: flex; justify-content: center; gap: 15px; margin-top: auto; padding-top: 10px;
    flex-shrink: 0;
}
button.spawn-btn {
    border: 1px solid rgba(110,240,255,0.18);
    background: linear-gradient(180deg, rgba(18,28,44,0.75), rgba(8,12,20,0.70));
    color: var(--text); padding: 10px 20px; border-radius: 999px;
    cursor:pointer; font-weight: 750; text-transform: uppercase; font-size: 12px;
    transition: all .2s ease;
    box-shadow: 0 0 0 1px rgba(180,120,255,0.06) inset;
}
button.spawn-btn:hover { filter: brightness(1.2); border-color:var(--cyan); }
button.spawn-btn:active { transform: scale(.98); }

/* STATUS FORM STYLES */
.status-form { display: none; flex-direction: column; gap: 5px; width: 100%; }
.status-form.active { display: flex; }
.form-row { display: flex; gap: 5px; align-items: center; justify-content: space-between; }
.form-label { font-size: 10px; color: var(--muted); width: 40px; }
.form-input { 
    flex: 1; 
    background: rgba(0,0,0,0.3); border: 1px solid rgba(110,240,255,0.2);
    color: var(--cyan); font-size: 11px; padding: 4px 6px; border-radius: 4px;
    font-family: ui-monospace, monospace;
    transition: box-shadow 0.3s, border-color 0.3s;
}
.form-input:focus { outline: none; border-color: var(--cyan); }

/* Purple Glow Animation */
.form-input.glow-purple {
    border-color: var(--purple);
    box-shadow: 0 0 12px var(--purple);
}

.empty-msg { font-size: 12px; color: var(--muted); font-style: italic; text-align: center; margin-top: 10px;}

/* Encrypt Button */
.btn-encrypt {
    width: 100%; margin-top: 5px;
    background: var(--purple); color: #000; border: 1px solid #fff;
    box-shadow: 0 0 15px var(--purple); animation: pulse 2s infinite;
    padding: 10px; border-radius: 8px; font-weight: 800; cursor: pointer;
    text-transform: uppercase; letter-spacing: 0.1em;
}
@keyframes pulse { 50% { box-shadow: 0 0 5px var(--purple); } }

</style>
</head>

<body> 
<div class="wrap"> 
    <h1>Opportunity Map</h1>
    <div class="subtitle">Create a map of value using 2km Altitude Imaging</div>

    <div class="card">
        
        <div class="topbar">
            <div class="pill">
                <span class="pill-title">Source Data</span>
                <label for="imgUpload" class="btn-upload">Upload 1920x1080 Image</label>
                <input type="file" id="imgUpload" accept="image/*">
                <div style="font-size:10px; color:var(--muted); margin-top:5px; text-align:center;" id="fileNameDisplay">No Data</div>
            </div>

            <div class="pill" style="flex: 2;">
                <span class="pill-title">Object Analysis</span>
                <div id="statusContent">
                    <div class="empty-msg">Select an object on the map to analyze</div>
                </div>
            </div>

            <div class="pill">
                <span class="pill-title">Value of Map Data</span>
                <div id="progressArea">
                    <div class="sub" style="font-size:11px; margin-bottom:4px;">Data Complexity: <span id="pctText">0%</span></div>
                    <div class="progress-container">
                        <div class="progress-fill" id="progBar"></div>
                    </div>
                </div>
                <button id="btnEncrypt" class="btn-encrypt" style="display:none;">Encrypt Data</button>
            </div>
        </div>

        <div class="viewport-wrapper">
            <div class="map-viewport" id="mapContainer">
                <div class="grid-overlay"></div>
                <img id="mapImage" class="map-image" src="" style="display:none;">
                <div id="objLayer"></div>
            </div>
        </div>

        <div class="controls-bar">
            <button class="spawn-btn" onclick="spawnObject('ROCK')">+ New Rock</button>
            <button class="spawn-btn" onclick="spawnObject('GEM')">+ New Gem</button>
            <button class="spawn-btn" onclick="spawnObject('WRECK')">+ New Wreckage</button>
        </div>

    </div>
    <div style="margin-top:10px; font-size:12px; color:rgba(235,250,255,0.4);">
        PADUA REDEMPTION â€¢ CARTOGRAPHY MODULE
    </div>
</div> 

<script>
/**
 * OPPORTUNITY MAP LOGIC
 */

// Data
const objects = []; 
let selectedId = null;
let dragId = null;
let offset = { x:0, y:0 }; // Percent offset

// DOM
const mapContainer = document.getElementById('mapContainer');
const mapImage = document.getElementById('mapImage');
const objLayer = document.getElementById('objLayer');
const statusContent = document.getElementById('statusContent');
const progBar = document.getElementById('progBar');
const pctText = document.getElementById('pctText');
const btnEncrypt = document.getElementById('btnEncrypt');
const progressArea = document.getElementById('progressArea');
const imgUpload = document.getElementById('imgUpload');
const fileNameDisplay = document.getElementById('fileNameDisplay');

// --- 1. Image Upload ---
imgUpload.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(event){
            mapImage.src = event.target.result;
            mapImage.style.display = 'block';
            fileNameDisplay.textContent = file.name;
        }
        reader.readAsDataURL(file);
    }
});

// --- 2. Spawning Objects ---
function spawnObject(type) {
    const id = Date.now() + Math.random();
    
    // Config based on type
    let src = "";
    let fields = [];
    
    if(type === 'ROCK') {
        src = "boulder.png";
        fields = ['TYPE', 'MASS', 'INST', 'RES'];
    } else if(type === 'GEM') {
        src = "gem.png";
        fields = ['MINERAL', 'MASS'];
    } else if(type === 'WRECK') {
        src = "Salvage.png";
        fields = ['SIG', 'MASS', 'TYPE'];
    }

    // Create Data Object
    // Positions are now Percentages (0-100) to allow responsive scaling
    const objData = {
        id: id,
        type: type,
        x: 48, // Center (approx)
        y: 45, // Center (approx)
        src: src,
        fields: fields,
        values: {} 
    };

    // Init empty values
    fields.forEach(f => objData.values[f] = "");

    objects.push(objData);

    // Create DOM Element
    const img = document.createElement('img');
    img.src = src;
    img.className = 'map-obj';
    img.id = id;
    img.style.left = objData.x + '%';
    img.style.top = objData.y + '%';
    
    // Fallback for missing images
    img.onerror = () => {
        img.style.background = type==='GEM' ? '#f0f' : (type==='WRECK' ? '#0ff' : '#aaa');
        img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"; 
    };

    img.addEventListener('mousedown', (e) => startDrag(e, id));
    
    objLayer.appendChild(img);
    selectObject(id);
    updateProgress();
}

// --- 3. Drag & Drop Logic (Percent Based) ---
function startDrag(e, id) {
    e.preventDefault(); 
    dragId = id;
    selectObject(id); 

    const el = document.getElementById(id);
    const rect = el.getBoundingClientRect();
    const containerRect = mapContainer.getBoundingClientRect();

    // Calculate click offset relative to the object's top-left, converted to percentage of container
    offset.x = ((e.clientX - rect.left) / containerRect.width) * 100;
    offset.y = ((e.clientY - rect.top) / containerRect.height) * 100;

    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', stopDrag);
}

function onDrag(e) {
    if(!dragId) return;

    const containerRect = mapContainer.getBoundingClientRect();
    
    // Calculate new Position in Percent
    let newX = ((e.clientX - containerRect.left) / containerRect.width) * 100 - offset.x;
    let newY = ((e.clientY - containerRect.top) / containerRect.height) * 100 - offset.y;

    // Boundaries (0 to 96% assuming 4% width)
    if(newX < 0) newX = 0;
    if(newX > 96) newX = 96;
    if(newY < 0) newY = 0;
    if(newY > 96) newY = 96;

    // Snap to grid (approx 4% increments)
    newX = Math.round(newX / 4) * 4;
    
    // Aspect ratio adjustment for Y snapping (since 4% width != 4% height in px)
    // Actually, visually standardizing to % is easiest. 
    // Let's create an approximate square grid visually by using aspect ratio math
    // Aspect Ratio is 16:9. So 4% width is X pixels. 
    // To make a square, height needs to be 4 * (16/9) = ~7.1% height
    newY = Math.round(newY / 7.1) * 7.1;

    // Update Data
    const obj = objects.find(o => o.id == dragId);
    obj.x = newX;
    obj.y = newY;

    // Update Visuals
    const el = document.getElementById(dragId);
    el.style.left = newX + '%';
    el.style.top = newY + '%';
}

function stopDrag() {
    dragId = null;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', stopDrag);
}

// --- 4. Selection & Status Window ---
function selectObject(id) {
    selectedId = id;
    document.querySelectorAll('.map-obj').forEach(el => el.classList.remove('selected'));
    document.getElementById(id).classList.add('selected');
    renderStatusWindow(id);
}

function renderStatusWindow(id) {
    const obj = objects.find(o => o.id == id);
    statusContent.innerHTML = ''; 

    const form = document.createElement('div');
    form.className = 'status-form active';

    const head = document.createElement('div');
    head.innerHTML = `<strong style="color:var(--cyan)">${obj.type} DETECTED</strong>`;
    head.style.marginBottom = "5px";
    head.style.fontSize = "11px";
    form.appendChild(head);

    obj.fields.forEach(field => {
        const row = document.createElement('div');
        row.className = 'form-row';
        row.innerHTML = `
            <span class="form-label">${field}</span>
            <input type="text" class="form-input" maxlength="40" 
             value="${obj.values[field] || ''}" 
             data-field="${field}">
        `;
        form.appendChild(row);
    });

    statusContent.appendChild(form);

    const inputs = form.querySelectorAll('input');
    inputs.forEach(inp => {
        inp.addEventListener('input', (e) => {
            const f = e.target.dataset.field;
            obj.values[f] = e.target.value;
            
            // Trigger Purple Glow
            e.target.classList.add('glow-purple');
            // Remove after 500ms
            setTimeout(() => {
                e.target.classList.remove('glow-purple');
            }, 500);

            updateProgress(); 
        });
    });
}

// --- 5. Progress Logic ---
function updateProgress() {
    let totalScore = 0;
    objects.forEach(obj => {
        totalScore += 9; // Base score
        obj.fields.forEach(f => {
            if(obj.values[f] && obj.values[f].trim().length > 0) {
                totalScore += 5;
            }
        });
    });

    if(totalScore > 100) totalScore = 100;

    progBar.style.width = totalScore + '%';
    pctText.textContent = totalScore + '%';

    if(totalScore >= 100) {
        progressArea.style.display = 'none';
        btnEncrypt.style.display = 'block';
    } else {
        progressArea.style.display = 'block';
        btnEncrypt.style.display = 'none';
    }
}

// --- 6. End Game Animation ---
btnEncrypt.addEventListener('click', () => {
    btnEncrypt.disabled = true;
    btnEncrypt.textContent = "TRANSMITTING...";
    mapContainer.classList.add('collapsed');
    setTimeout(() => {
        statusContent.innerHTML = '<div style="color:var(--good); font-weight:bold; text-align:center;">DATA SECURED.<br>PACKET SENT.</div>';
    }, 1200);
});

</script>
</body>
</html>
